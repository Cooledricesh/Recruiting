# 광고주 온보딩 기능 테스트 가이드

## 수정 사항

### 1. 로그인 페이지 리다이렉션 로직 개선
**파일**: `src/app/login/page.tsx`

**변경 전**:
- 인플루언서 프로필만 확인
- 광고주 계정 로그인 시 온보딩 페이지로 이동하지 않음

**변경 후**:
```typescript
// 로그인 성공 후 역할별 프로필 확인
1. 인플루언서 프로필 API 호출
   - 성공 + 채널 있음 → isInfluencer = true
   - 404 → /onboarding/influencer로 리다이렉트
   - 403 → 광고주 계정일 수 있음 (다음 단계로)

2. 인플루언서가 아니면 광고주 프로필 API 호출
   - 성공 → isAdvertiser = true
   - 404 → /onboarding/advertiser로 리다이렉트
   - 403 → 인플루언서 계정 (이미 처리됨)

3. 프로필이 있으면 원래 목적지 또는 메인 페이지로 이동
```

### 2. 광고주 온보딩 페이지 구현
**파일**: `src/app/onboarding/advertiser/page.tsx`

**변경 전**:
```tsx
// "구현 예정" 메시지만 표시
<div>이 페이지는 아직 구현되지 않았습니다.</div>
```

**변경 후**:
```tsx
// AdvertiserProfileForm 컴포넌트 통합
<AdvertiserProfileForm
  initialData={profile}
  onSuccess={() => router.push('/')}
/>

// 기능:
// - 프로필 로딩 중 표시
// - 프로필이 이미 있으면 메인 페이지로 리다이렉트
// - 저장 완료 시 메인 페이지로 이동
```

---

## 테스트 시나리오

### 시나리오 1: 광고주 신규 회원 로그인

**테스트 계정**:
- 이메일: psyrehabtest@gmail.com
- 비밀번호: Aa12345678
- 역할: 광고주
- 프로필: 미등록

**예상 동작**:
1. 로그인 페이지에서 계정 정보 입력
2. 로그인 버튼 클릭
3. 로그인 성공
4. **자동으로 `/onboarding/advertiser` 페이지로 리다이렉트**
5. 광고주 정보 입력 폼 표시

**확인 사항**:
- [ ] `/onboarding/advertiser`로 리다이렉트되는가?
- [ ] 광고주 정보 입력 폼이 표시되는가?
- [ ] 모든 필수 필드가 표시되는가? (업체명, 주소, 위치, 전화번호, 카테고리, 사업자번호, 대표자명)

---

### 시나리오 2: 광고주 정보 입력 및 저장

**전제 조건**: 시나리오 1 완료 (온보딩 페이지에 있음)

**테스트 데이터**:
```
업체명: 테스트 카페
주소: (서울시 강남구 테헤란로 123 선택)
위치: 강남역 3번 출구
업장 전화번호: 02-1234-5678
카테고리: 카페/디저트
사업자등록번호: 123-45-67891 (유효한 번호)
대표자명: 홍길동
```

**예상 동작**:
1. 모든 필드에 데이터 입력
2. 주소 검색 버튼 클릭 시 Daum Postcode 팝업 오픈
3. 주소 선택 시 자동 입력
4. 사업자번호 입력 시 자동 포맷팅 (123-45-67891)
5. 저장 버튼 클릭
6. 사업자번호 중복 검사 진행
7. 프로필 저장 성공
8. Toast 알림: "저장 완료"
9. **메인 페이지(`/`)로 리다이렉트**

**확인 사항**:
- [ ] 주소 검색이 정상 동작하는가?
- [ ] 사업자번호가 자동 포맷팅되는가?
- [ ] 필수 필드 미입력 시 에러 메시지 표시되는가?
- [ ] 저장 완료 후 Toast 알림이 표시되는가?
- [ ] 메인 페이지로 리다이렉트되는가?

---

### 시나리오 3: 사업자번호 검증

#### 3-1. 형식 검증

**테스트 케이스**:

| 입력값 | 예상 결과 |
|--------|----------|
| 123456789 (9자리) | "사업자등록번호는 10자리 숫자여야 합니다" |
| 12345678901 (11자리) | "사업자등록번호는 10자리 숫자여야 합니다" |
| abc1234567 (문자 포함) | "유효하지 않은 사업자등록번호입니다" |
| 1234567890 (체크섬 오류) | "유효하지 않은 사업자등록번호입니다" |
| 1234567891 (유효) | 검증 통과 |

**확인 사항**:
- [ ] 형식 검증이 정상 동작하는가?
- [ ] 체크섬 검증이 정상 동작하는가?

#### 3-2. 중복 검증

**전제 조건**: 한 계정이 이미 사업자번호 등록 완료

**테스트 케이스**:
1. 같은 사업자번호 입력
2. 저장 버튼 클릭
3. 에러 메시지: "이미 등록된 사업자번호입니다"

**확인 사항**:
- [ ] 중복 검사가 정상 동작하는가?
- [ ] 에러 메시지가 표시되는가?

---

### 시나리오 4: 광고주 기존 회원 로그인

**전제 조건**: 시나리오 2 완료 (프로필 등록 완료)

**예상 동작**:
1. 로그아웃
2. 다시 로그인
3. 로그인 성공
4. **온보딩 페이지를 거치지 않고 메인 페이지(`/`)로 이동**

**확인 사항**:
- [ ] 온보딩 페이지로 리다이렉트되지 않는가?
- [ ] 메인 페이지로 바로 이동하는가?

---

### 시나리오 5: 인플루언서 계정 로그인 (기존 기능 확인)

**테스트 목적**: 광고주 기능 추가 후 인플루언서 기능이 정상 동작하는지 확인

**예상 동작**:
1. 인플루언서 계정으로 로그인
2. 프로필이 없으면 `/onboarding/influencer`로 리다이렉트
3. 프로필이 있으면 메인 페이지로 이동

**확인 사항**:
- [ ] 인플루언서 온보딩이 정상 동작하는가?
- [ ] 광고주 API를 호출하지 않는가?

---

## API 엔드포인트 테스트

### 1. 광고주 프로필 조회
```bash
# 인증 없이 호출
curl -X GET "http://localhost:3002/api/advertiser/profile"

# 예상 응답: 401 Unauthorized
{"error":{"code":"UNAUTHORIZED_ACCESS","message":"인증이 필요합니다"}}
```

### 2. 사업자번호 중복 확인
```bash
# 미등록 사업자번호
curl -X GET "http://localhost:3002/api/advertiser/business-number/1234567891/duplicate"

# 예상 응답: 200 OK
{"isDuplicate":false}
```

---

## 문제 해결

### 문제 1: 로그인 후 온보딩 페이지로 이동하지 않음

**원인**: 인플루언서 프로필 확인 후 바로 리턴하여 광고주 프로필 확인 로직이 실행되지 않음

**해결**:
- `isInfluencer` 플래그 추가
- 인플루언서가 아닐 때만 광고주 프로필 확인
- 두 API 호출을 순차적으로 실행하되, 첫 번째가 실패해도 두 번째 실행

### 문제 2: 광고주 온보딩 페이지가 구현되지 않음

**원인**: 페이지가 존재하지만 "구현 예정" 메시지만 표시

**해결**:
- `AdvertiserProfileForm` 컴포넌트 통합
- 프로필 로딩 및 리다이렉션 로직 추가

---

## 체크리스트

### 기능 구현
- [x] 로그인 페이지 리다이렉션 로직 개선
- [x] 광고주 온보딩 페이지 구현
- [x] 광고주 프로필 폼 컴포넌트
- [x] 사업자번호 검증 로직
- [x] 주소 검색 기능

### 코드 품질
- [x] TypeScript 타입 체크 통과
- [x] ESLint 검증 통과
- [x] 하드코딩된 값 없음

### 테스트 필요
- [ ] 광고주 신규 회원 로그인
- [ ] 광고주 정보 입력 및 저장
- [ ] 사업자번호 형식 검증
- [ ] 사업자번호 중복 검증
- [ ] 광고주 기존 회원 로그인
- [ ] 인플루언서 기능 정상 동작 확인

---

## 다음 단계

테스트 완료 후:
1. Supabase DB에 실제 데이터 저장 확인
2. 국세청 API 연동 (선택 사항)
3. 프로필 수정 기능 테스트
4. 체험단 등록 시 프로필 검증 확인
